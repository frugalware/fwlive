#!/bin/sh

ROOTSIZE="1"
ROOTCOMPRESS="lzo"
ROOTREPO="current"
QEMURAM="1024"
QEMUSIZE="4G"

error()
{
  echo "$1"
  exit 1
}

while test "$#" -gt 0; do
  case "$1" in
    --rootsize)
      test -z "$2" && error "No argument supplied: rootsize"
      ROOTSIZE="$2"
      shift
      ;;
    --rootcompress)
      test -z "$2" && error "No argument supplied: rootcompress"
      ROOTCOMPRESS="$2"
      shift
      ;;
    --rootrepo)
      test -z "$2" && error "No argument supplied: rootrepo"
      ROOTREPO="$2"
      shift
      ;;
    --qemuram)
      test -z "$2" && error "No argument supplied: qemuram"
      QEMURAM="$2"
      shift
      ;;
    --qemusize)
      test -z "$2" && error "No argument supplied: qemusize"
      QEMUSIZE="$2"
      shift
      ;;
    *)
      error "Invalid argument: $1"
      ;;
  esac
  shift
done

cat > fwlive.cfg << EOF
ROOTSIZE="$ROOTSIZE"
ROOTCOMPRESS="$ROOTCOMPRESS"
ROOTREPO="$ROOTREPO"
QEMUSIZE="$QEMUSIZE"
QEMURAM="$QEMURAM"
EOF

cat > Makefile << EOF
fwlive.iso: squashfs.img
	bin/create-iso

squashfs.img:
	bin/create-rootfs

clean:
	\$(RM) fwlive.iso squashfs.img
EOF
